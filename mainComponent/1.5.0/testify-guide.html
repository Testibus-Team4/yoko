<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Implementing Testify to a RMI Java Application :: Testify Documentation</title>
    <meta name="generator" content="Antora 3.1.1">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">Testify Documentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
   
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="mainComponent" data-version="1.5.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Features</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Testify</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="testify-guide.html">Implementing Testify to a RMI Java Application</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="bus/bus-concept.html">Bus Concept</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="bus/bus-processes.html">Using the Bus across Threads and Sub Processes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="extending-annotations.html">Extending Annotations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="part-runner.html">How to use @ConfigurePartRunner</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="jul-logging.html">Enabling J.U.L Logging</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Features</span>
    <span class="version">1.5.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="index.html">Features</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">1.5.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Features</a></li>
    <li><a href="testify-guide.html">Implementing Testify to a RMI Java Application</a></li>
  </ul>
</nav>
  
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Implementing Testify to a RMI Java Application</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This guide will explain and allow you to implement Testify to a Remote Method Invocation (RMI) application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_steps_to_build_testify"><a class="anchor" href="#_steps_to_build_testify"></a>Steps to build Testify</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clone the following Yoko repository and go to the directory <code><em class="path">RMI</em></code> in the root directory of the repository.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">git clone https://github.com/Testibus-Team4/yoko.git
cd yoko</code></pre>
</div>
</div>
</li>
<li>
<p>Navigate to <code><em class="path">RMI_Demo/start</em></code> directory using the interface of your chosen IDE and also in the terminal using the command folowing command from the <code><em class="path">yoko</em></code> directory.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">cd RMI_Demo/start</code></pre>
</div>
</div>
</li>
<li>
<p>Find the <code><em class="path">build.gradle</em></code> within that repository, and add the following code to the <code>dependencies</code> section of the file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">testImplementation 'org.apache.yoko:yoko-testify:1.5.0.9cce293956'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your <code><em class="path">build.gradle</em></code> file should now look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>dependencies {
    testImplementation 'org.apache.yoko:yoko-testify:1.5.0.9cce293956'
    testImplementation 'org.junit.jupiter:junit-jupiter:5.8.2'
    testRuntimeOnly 'org.junit.platform:junit-platform-runner:1.8.2'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.8.2'
}</pre>
</div>
</div>
<div class="paragraph">
<p>The dependency will be added to the project and the Testify library will be available for use.</p>
</div>
</li>
<li>
<p>Refresh the <code><em class="path">build.gradle</em></code> dependencies using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">gradle --refresh-dependencies</code></pre>
</div>
</div>
</li>
<li>
<p>Navigate to <code><em class="path">/src/test/java/com/acme/hello/InitialTest.java</em></code> using your IDE interface. This is the file that will contain the tests.</p>
</li>
<li>
<p>Add the following imports into intitialTest.java:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import testify.bus.Bus;
import testify.bus.TypeSpec;
import testify.jupiter.annotation.ConfigurePartRunner;
import testify.parts.PartRunner;</code></pre>
</div>
</div>
</li>
<li>
<p>Next lets add the annotation to the InitialTest class. Do this by adding the following code above the class declaration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ConfigurePartRunner(PartRunner.class)</code></pre>
</div>
</div>
</li>
<li>
<p>Now lets expand the setup method to include the following code:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BeforeAll
    static void setup(PartRunner runner) {
        // When forking use new Java Virtual Machine
        runner.useNewJVMWhenForking();
        // Create a new part called HelloServer
        runner.fork("HelloServer",
                // Tell Testify how to start this new part
                InitialTest::runServer,
                // Tell Testify how to stop this part
                bus -&gt; bus
                        // Send a stp request
                        .put(STOP_REQUESTED, 0)
                        // Wait for stopped server response
                        .get(SERVER_STOPPED));
        // Wait for the server to start
        port = runner.bus("HelloServer").get(SERVER_STARTED);
        lookupURL = "//localhost:" + port + "/MessengerService";
        System.out.println(lookupURL);
    }</code></pre>
</div>
</div>
</li>
<li>
<p>The above code will call on the <code>PartRunner</code> parameter. This allows us to use the methods within part runner and call on and use <code>useNewJVMWhenForking()</code> and also <code>fork()</code>. <code>useNewJVMWhenForking()</code> name means to use a new Java Virtual Machine every time something is forked. <code>fork()</code> calls upon the <code>runServer()</code> method.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    // This method runs in the server process
    private static void runServer(Bus bus) {
        logging();
        int port = HelloServer.start(0);
        // Notify the test process that the server has now started on a particular port
        bus.put(SERVER_STARTED, port);
        System.out.println(port);
        // Get STOP_REQUESTED event from the bus
        bus.get(STOP_REQUESTED);
        // call stop method from HelloServer class
        HelloServer.stop();
        // Send SERVER_STOPPED event and port back to the client
        bus.put(SERVER_STOPPED, port);
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also; now you can go ahead and remove the call for <code>logging()</code> from the <code>testHello()</code> method. This is because you have now called it in the <code>runServer()</code> method.</p>
</div>
<div class="paragraph">
<p>The above code will call on the <code>Bus</code> parameter. This allows us to use the methods within the bus and call on and use <code>put()</code> and also <code>get()</code>. <code>put()</code> will put the <code>SERVER_STARTED</code> event and the port number on the bus. <code>get()</code> will get the <code>STOP_REQUESTED</code> event from the bus. This allows the client and server communicate with each other with more detail. Using Bus also allows us to know how long a server takes to start, when the client starts to interact with the server and also when the server shuts down.</p>
</div>
</li>
<li>
<p>Since you are now able to send events and messages between the client and server; you can send the port across too. This means you can go ahead and replace:</p>
<div class="listingblock">
<div class="content">
<pre>    static int port = 1099;</pre>
</div>
</div>
<div class="paragraph">
<p>with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    static int port;</code></pre>
</div>
</div>
</li>
<li>
<p>You are now ready to build your application using gradle and see how Testify has helped testing. In the <em class="path">start</em>` repository, run either of following commands:</p>
<div class="ulist">
<ul>
<li>
<p>To build <strong>with</strong> tests use:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">./gradlew build</code></pre>
</div>
</div>
</li>
<li>
<p>To build <strong>without</strong> tests use:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">./gradlew build -x test</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_testify_works_in_intitialtest_java"><a class="anchor" href="#_how_testify_works_in_intitialtest_java"></a>How Testify works in intitialTest.java</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import testify.bus.Bus;
import testify.bus.TypeSpec;
import testify.jupiter.annotation.ConfigurePartRunner;
import testify.parts.PartRunner;</code></pre>
</div>
</div>
<div class="paragraph">
<p>These imports enable Testify in your testing. The annotation you using from Testify is <code>@ConfigurePartRunner</code>. This annoation allows us to make use of <code>runner.useNewJVMWhenForking()</code> and <code>runner.fork()</code>. These runners allow you to run methods from your app/project within the testing. The <code>@ConfigurePartRunner</code> annotation is further explained in <a href="https://testibus-team4.github.io/yoko/mainComponent/1.5.0/part-runner.html" class="bare">https://testibus-team4.github.io/yoko/mainComponent/1.5.0/part-runner.html</a> .</p>
</div>
<div class="paragraph">
<p>In intitialTest.java the tests are sending and getting events from methods using the bus (more information about the bus can be found at <a href="https://testibus-team4.github.io/yoko/mainComponent/1.5.0/bus/testify.html" class="bare">https://testibus-team4.github.io/yoko/mainComponent/1.5.0/bus/testify.html</a>). Thanks to these events you are making sure that a new instruction is not run until the previous one complete and the correct values are shared across processes/threads. This is done using TypeSpecs which are Testify specific. TypeSpecs are enums that you can call. In this case these are the events. Thanks to these TypeSpecs you are able to know:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How long a server took to start (<code>SERVER_STARTED</code>)</p>
</li>
<li>
<p>When the client starts to interact with the server</p>
</li>
<li>
<p>When the server can shut down (<code>STOP_REQUESTED</code>)</p>
</li>
<li>
<p>When the server shut down (<code>SERVER_STOPPED</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is all done in the setup() method which also is annotated using <code>@BeforeAll</code> - this means that nothing will happen until this method is completed. The most important method is runServer() which takes in bus as a parameter. In this method everything is declared and then passed to the setup() method inside the runner.fork() method as a parameter.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
